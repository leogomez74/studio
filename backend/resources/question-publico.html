<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cuestionario Público</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --background: 220 13% 97%;
            --foreground: 224 71.4% 4.1%;
            --card: 0 0% 100%;
            --card-foreground: 224 71.4% 4.1%;
            --primary: 209 78% 34%;
            --primary-foreground: 0 0% 100%;
            --secondary: 220 13% 91%;
            --secondary-foreground: 220 9% 38%;
            --muted: 220 13% 91%;
            --muted-foreground: 220 9% 45%;
            --accent: 220 14% 96%;
            --border: 220 13% 85%;
            --input: 220 13% 85%;
            --ring: 209 78% 34%;
            --radius: 0.5rem;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: hsl(var(--background));
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        headline: ['Space Grotesk', 'sans-serif'],
                    },
                    colors: {
                        background: 'hsl(var(--background))',
                        foreground: 'hsl(var(--foreground))',
                        card: 'hsl(var(--card))',
                        'card-foreground': 'hsl(var(--card-foreground))',
                        primary: 'hsl(var(--primary))',
                        'primary-foreground': 'hsl(var(--primary-foreground))',
                        secondary: 'hsl(var(--secondary))',
                        'secondary-foreground': 'hsl(var(--secondary-foreground))',
                        muted: 'hsl(var(--muted))',
                        'muted-foreground': 'hsl(var(--muted-foreground))',
                        accent: 'hsl(var(--accent))',
                        border: 'hsl(var(--border))',
                        input: 'hsl(var(--input))',
                        ring: 'hsl(var(--ring))',
                    },
                    borderRadius: {
                        lg: 'var(--radius)',
                        md: 'calc(var(--radius) - 2px)',
                        sm: 'calc(var(--radius) - 4px)',
                    }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen flex items-center justify-center p-2 md:p-4">
    <div class="w-full max-w-3xl">
        <div id="alert" class="hidden p-4 mb-4 text-sm rounded-lg" role="alert"></div>

        <div class="bg-card text-card-foreground rounded-xl border shadow-lg">
            <div class="p-4 md:p-6">
                <div class="text-center space-y-1">
                    <p class="text-xs font-semibold tracking-wide text-primary uppercase">Paso a paso</p>
                    <h1 class="text-2xl md:text-3xl font-headline font-bold text-primary">Cuestionario Público</h1>
                    <p class="text-muted-foreground text-sm md:text-base">Queremos entender mejor tu necesidad. Son 3 pasos rápidos.</p>
                </div>

                <div class="mt-6">
                    <div class="flex items-center gap-3">
                        <div class="flex-1 h-2 rounded-full bg-secondary" aria-hidden="true">
                            <div id="progressBar" class="h-2 rounded-full bg-primary transition-all duration-200" style="width: 33%"></div>
                        </div>
                        <span id="stepLabel" class="text-xs font-semibold text-muted-foreground">Paso 1 de 3</span>
                    </div>
                </div>
            </div>

            <form id="questionnaireForm" class="p-4 md:p-6 pt-0 space-y-6">
                <div id="step-1" class="space-y-4">
                    <h2 class="text-lg font-semibold text-foreground">1. ¿Qué te interesa?</h2>
                    <div class="grid md:grid-cols-3 gap-4">
                        <label class="block cursor-pointer group">
                            <input type="radio" name="interes" value="credito" class="peer sr-only">
                            <div class="border rounded-lg p-4 h-full transition hover:shadow-md peer-checked:border-primary peer-checked:ring-2 peer-checked:ring-primary/20 bg-background">
                                <p class="text-sm font-semibold text-foreground">Crédito</p>
                                <p class="text-xs text-muted-foreground mt-1">Financia tus metas y obligaciones.</p>
                            </div>
                        </label>
                        <label class="block cursor-pointer group">
                            <input type="radio" name="interes" value="servicios_legales" class="peer sr-only">
                            <div class="border rounded-lg p-4 h-full transition hover:shadow-md peer-checked:border-primary peer-checked:ring-2 peer-checked:ring-primary/20 bg-background">
                                <p class="text-sm font-semibold text-foreground">Servicios legales</p>
                                <p class="text-xs text-muted-foreground mt-1">Divorcios, traspasos, sucesiones u otros.</p>
                            </div>
                        </label>
                        <label class="block cursor-pointer group">
                            <input type="radio" name="interes" value="ambos" class="peer sr-only">
                            <div class="border rounded-lg p-4 h-full transition hover:shadow-md peer-checked:border-primary peer-checked:ring-2 peer-checked:ring-primary/20 bg-background">
                                <p class="text-sm font-semibold text-foreground">Ambos</p>
                                <p class="text-xs text-muted-foreground mt-1">Necesito crédito y apoyo legal.</p>
                            </div>
                        </label>
                    </div>
                </div>

                <div id="step-2" class="space-y-4 hidden">
                    <h2 class="text-lg font-semibold text-foreground">2. Detalles de tu necesidad</h2>

                    <div id="creditoFields" class="space-y-3 hidden">
                        <p class="text-sm font-semibold text-muted-foreground">Crédito</p>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-foreground mb-1">Monto aproximado</label>
                                <select name="monto" class="w-full px-3 py-2 bg-background border border-input rounded-md text-sm">
                                    <option value="">Selecciona un rango</option>
                                    <option value="100k-300k">100 mil - 300 mil</option>
                                    <option value="300k-500k">300 mil - 500 mil</option>
                                    <option value="500k-690k">500 mil - 690 mil</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-foreground mb-1">Uso del crédito</label>
                                <select name="uso_credito" class="w-full px-3 py-2 bg-background border border-input rounded-md text-sm">
                                    <option value="">Selecciona</option>
                                    <option value="consumo">Consumo / personales</option>
                                    <option value="consolidacion">Consolidación de deudas</option>
                                    <option value="negocio">Negocio / capital de trabajo</option>
                                </select>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <label class="block text-sm font-medium text-foreground mb-1">Condición laboral</label>
                            <div class="grid md:grid-cols-3 gap-3">
                                <label class="block cursor-pointer group">
                                    <input type="radio" name="condicion_laboral" value="empleado_activo" class="peer sr-only">
                                    <div class="border rounded-lg p-3 h-full transition hover:shadow-md peer-checked:border-primary peer-checked:ring-2 peer-checked:ring-primary/20 bg-background text-center">
                                        <p class="text-sm font-medium text-foreground">Empleado público activo</p>
                                    </div>
                                </label>
                                <label class="block cursor-pointer group">
                                    <input type="radio" name="condicion_laboral" value="pensionado_pj" class="peer sr-only">
                                    <div class="border rounded-lg p-3 h-full transition hover:shadow-md peer-checked:border-primary peer-checked:ring-2 peer-checked:ring-primary/20 bg-background text-center">
                                        <p class="text-sm font-medium text-foreground">Pensionado del Poder Judicial</p>
                                    </div>
                                </label>
                                <label class="block cursor-pointer group">
                                    <input type="radio" name="condicion_laboral" value="pensionado_hacienda" class="peer sr-only">
                                    <div class="border rounded-lg p-3 h-full transition hover:shadow-md peer-checked:border-primary peer-checked:ring-2 peer-checked:ring-primary/20 bg-background text-center">
                                        <p class="text-sm font-medium text-foreground">Pensionado por Hacienda</p>
                                    </div>
                                </label>
                            </div>
                        </div>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div id="empresaWrapper">
                                <label class="block text-sm font-medium text-foreground mb-1">Empresa en la que Labora</label>
                                <div id="companyContainer" class="relative">
                                    <button type="button" id="companyTrigger" class="w-full h-10 px-3 bg-background border border-input rounded-md text-sm text-left flex items-center justify-between">
                                        <span id="companyLabel" class="truncate text-muted-foreground">Selecciona</span>
                                        <span class="text-xs text-muted-foreground">▼</span>
                                    </button>
                                    <div id="companyDropdown" class="hidden absolute z-20 mt-1 w-full rounded-md border bg-white shadow-lg">
                                        <div class="p-2 border-b">
                                            <input id="companySearch" type="text" placeholder="Buscar empresa" class="w-full px-2 py-1 text-sm border rounded-md" aria-label="Buscar empresa">
                                        </div>
                                        <div id="companyList" class="max-h-40 overflow-y-auto"></div>
                                    </div>
                                    <input type="hidden" id="companyValue" name="situacion_laboral" value="">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-foreground mb-1">Tiempo laborando</label>
                                <select name="antiguedad_laboral" class="w-full px-3 py-2 bg-background border border-input rounded-md text-sm">
                                    <option value="">Selecciona</option>
                                    <option value="<1a">Menos de 1 año</option>
                                    <option value="1-3a">1 a 3 años</option>
                                    <option value="3-5a">3 a 5 años</option>
                                    <option value=">5a">Más de 5 años</option>
                                </select>
                            </div>
                        </div>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-foreground mb-1">Ingreso mensual aproximado</label>
                                <select name="ingreso" class="w-full px-3 py-2 bg-background border border-input rounded-md text-sm">
                                    <option value="">Selecciona</option>
                                    <option value="300k-500k">300 mil - 500 mil</option>
                                    <option value="500k-800k">500 mil - 800 mil</option>
                                    <option value="800k-1.2m">800 mil - 1.2M</option>
                                    <option value=">1.2m">Más de 1.2M</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-foreground mb-1">¿Tienes deudas actualmente?</label>
                                <select name="tiene_deudas" class="w-full px-3 py-2 bg-background border border-input rounded-md text-sm">
                                    <option value="">Selecciona</option>
                                    <option value="no">No</option>
                                    <option value="si_1_2">Sí, 1-2 créditos</option>
                                    <option value="si_3_mas">Sí, 3 o más</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div id="legalesFields" class="space-y-3 hidden">
                        <p class="text-sm font-semibold text-muted-foreground">Servicios legales</p>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-foreground mb-1">Tipo de trámite</label>
                                <div class="space-y-2 border rounded-md p-3 bg-background">
                                    <label class="flex items-center gap-2 text-sm text-foreground">
                                        <input type="checkbox" name="tramites" value="divorcio" class="h-4 w-4 text-primary border-input rounded">
                                        <span>Divorcio</span>
                                    </label>
                                    <label class="flex items-center gap-2 text-sm text-foreground">
                                        <input type="checkbox" name="tramites" value="traspaso" class="h-4 w-4 text-primary border-input rounded">
                                        <span>Traspaso de bienes</span>
                                    </label>
                                    <label class="flex items-center gap-2 text-sm text-foreground">
                                        <input type="checkbox" name="tramites" value="sucesion" class="h-4 w-4 text-primary border-input rounded">
                                        <span>Sucesiones</span>
                                    </label>
                                    <label class="flex items-center gap-2 text-sm text-foreground">
                                        <input type="checkbox" name="tramites" value="otros" class="h-4 w-4 text-primary border-input rounded">
                                        <span>Otros</span>
                                    </label>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-foreground mb-1">Urgencia</label>
                                <select name="urgencia" class="w-full px-3 py-2 bg-background border border-input rounded-md text-sm">
                                    <option value="">Selecciona</option>
                                    <option value="inmediata">Inmediata (menos de 15 días)</option>
                                    <option value="30-60">En 30 - 60 días</option>
                                    <option value=">60">En más de 60 días</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-foreground mb-1">Breve descripción</label>
                            <textarea name="detalle_legal" rows="3" class="w-full px-3 py-2 bg-background border border-input rounded-md text-sm" placeholder="Cuéntanos el contexto del trámite"></textarea>
                        </div>
                    </div>
                </div>

                <div id="step-3" class="space-y-4 hidden">
                    <h2 class="text-lg font-semibold text-foreground">3. Perfil financiero</h2>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-foreground mb-1">¿Has tenido créditos antes? *</label>
                            <select name="experiencia_crediticia" class="w-full px-3 py-2 bg-background border border-input rounded-md text-sm">
                                <option value="">Selecciona</option>
                                <option value="si_bancarios">Sí, con bancos</option>
                                <option value="si_cooperativas">Sí, con cooperativas</option>
                                <option value="si_otros">Sí, con otras entidades</option>
                                <option value="no">No, es mi primer crédito</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-foreground mb-1">Historial de pagos *</label>
                            <select name="historial_mora" class="w-full px-3 py-2 bg-background border border-input rounded-md text-sm">
                                <option value="">Selecciona</option>
                                <option value="siempre_al_dia">Siempre al día</option>
                                <option value="atrasos_ocasionales">Atrasos ocasionales (1-2 veces)</option>
                                <option value="atrasos_frecuentes">Atrasos frecuentes</option>
                                <option value="no_aplica">No aplica / Primer crédito</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-foreground mb-1">Tipo de vivienda *</label>
                            <select name="tipo_vivienda" class="w-full px-3 py-2 bg-background border border-input rounded-md text-sm">
                                <option value="">Selecciona</option>
                                <option value="propia_pagada">Propia (pagada)</option>
                                <option value="propia_hipotecada">Propia (con hipoteca)</option>
                                <option value="alquilada">Alquilada</option>
                                <option value="familiar">Familiar / Prestada</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-foreground mb-1">Personas a tu cargo *</label>
                            <select name="dependientes" class="w-full px-3 py-2 bg-background border border-input rounded-md text-sm">
                                <option value="">Selecciona</option>
                                <option value="0">Ninguna</option>
                                <option value="1-2">1 - 2 personas</option>
                                <option value="3-4">3 - 4 personas</option>
                                <option value=">4">Más de 4 personas</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-foreground mb-1">¿Cómo conociste Credipep?</label>
                        <select name="origen_lead" class="w-full px-3 py-2 bg-background border border-input rounded-md text-sm">
                            <option value="">Selecciona</option>
                            <option value="redes_sociales">Redes sociales</option>
                            <option value="recomendacion">Recomendación</option>
                            <option value="google">Búsqueda en Google</option>
                            <option value="publicidad">Publicidad</option>
                            <option value="otro">Otro</option>
                        </select>
                    </div>
                </div>

                <div class="flex items-center justify-between pt-2">
                    <button type="button" id="backBtn" class="inline-flex items-center gap-2 rounded-md border px-4 py-2 text-sm font-medium text-foreground bg-background hover:bg-accent disabled:opacity-50" disabled>Atrás</button>
                    <div class="flex items-center gap-2">
                        <button type="button" id="nextBtn" class="inline-flex items-center justify-center rounded-md text-sm font-medium bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">Siguiente</button>
                        <button type="submit" id="submitBtn" class="hidden inline-flex items-center justify-center rounded-md text-sm font-medium bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">Enviar</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div id="successDialog" class="hidden fixed inset-0 z-50 flex items-center justify-center">
        <div class="fixed inset-0 bg-black/50" onclick="closeSuccessDialog()"></div>
        <div class="relative bg-card rounded-xl shadow-2xl p-6 md:p-8 max-w-md mx-4 text-center" style="animation: fadeIn 0.2s ease-out;">
            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
            </div>
            <h2 class="text-xl font-headline font-bold text-foreground mb-2">Listo</h2>
            <p class="text-muted-foreground mb-6">¡Pronto un asesor de Credipep te escribirá para ayudarte!</p>
            <button onclick="closeSuccessDialog()" class="w-full inline-flex items-center justify-center rounded-md text-sm font-medium bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">Entendido</button>
        </div>
    </div>

    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>

    <script>
        const steps = ['step-1', 'step-2', 'step-3'];
        let currentStep = 0;

        function showStep(index) {
            steps.forEach((id, i) => {
                const el = document.getElementById(id);
                if (!el) return;
                el.classList.toggle('hidden', i !== index);
            });
            document.getElementById('backBtn').disabled = index === 0;
            document.getElementById('nextBtn').classList.toggle('hidden', index === steps.length - 1);
            document.getElementById('submitBtn').classList.toggle('hidden', index !== steps.length - 1);
            const percent = ((index + 1) / steps.length) * 100;
            document.getElementById('progressBar').style.width = `${percent}%`;
            document.getElementById('stepLabel').textContent = `Paso ${index + 1} de ${steps.length}`;
        }

        function showAlert(message, type = 'error') {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = `p-4 mb-4 text-sm rounded-lg ${type === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`;
            alert.classList.remove('hidden');
            if (type === 'success') {
                setTimeout(() => alert.classList.add('hidden'), 4000);
            }
        }

        function clearAlert() {
            document.getElementById('alert').classList.add('hidden');
        }

        function updateDynamicBlocks() {
            const interes = document.querySelector('input[name="interes"]:checked')?.value;
            const showCredito = interes === 'credito' || interes === 'ambos';
            const showLegales = interes === 'servicios_legales' || interes === 'ambos';
            document.getElementById('creditoFields').classList.toggle('hidden', !showCredito);
            document.getElementById('legalesFields').classList.toggle('hidden', !showLegales);
        }

        function updateCondicionLaboral() {
            const condicion = document.querySelector('input[name="condicion_laboral"]:checked')?.value;
            const empresaWrapper = document.getElementById('empresaWrapper');
            // Solo mostrar empresa si es empleado activo
            const showEmpresa = condicion === 'empleado_activo';
            empresaWrapper.classList.toggle('hidden', !showEmpresa);
            // Limpiar empresa si se oculta
            if (!showEmpresa) {
                document.getElementById('companyValue').value = '';
                document.getElementById('companyLabel').textContent = 'Selecciona';
                document.getElementById('companyLabel').classList.add('text-muted-foreground');
            }
        }

        const companyOptions = [
            'A.N.E.P.',
            'ARCHIVO NACIONAL',
            'ASAMBLEA LEGISLATIVA',
            'AVIACION CIVIL',
            'AYA',
            'C.C.S.S',
            'C.N.P.',
            'CEN-CINAI',
            'CN MUSICA',
            'CNC',
            'CONAVI',
            'CONTROL DE MIGRACIÓN Y EXTRANJERÍA',
            'CORONADO',
            'COSEVI',
            'DEFENSORÍA DE LOS HABITANTES',
            'DESARROLLO DE LA COMUNIDAD',
            'DIRECCIÓN GENERAL DE SERVICIO CIVIL',
            'DIRECCIÓN NACIONAL DE PENSIONES',
            'FANAL',
            'FITOSANITARIO',
            'FONAFIFO',
            'GOBIERNO CENTRAL INTEGRA',
            'I.A.F.A.',
            'I.C.E.',
            'I.C.O.D.E.R',
            'I.M.A.S',
            'ICE',
            'ICE EMERGENCIAS 911',
            'ICE ENERGIA Y TELEC.',
            'IFAM',
            'IMPRENTA NACIONAL',
            'INA',
            'INDER (IDA)',
            'INTA',
            'INVU',
            'JUNTA ADM. REGISTRO NACIONAL',
            'MIN DE AGRICULTURA Y GANADERÍA',
            'MIN DE CIENCIA TECNOLOGÍA Y TELECOMUNICACIONES',
            'MIN DE COMERCIO EXTERIOR',
            'MIN DE CULT.JUV Y DEPORTES',
            'MIN DE ECO.IND Y COMERCIO',
            'MIN DE GOBERNACIÓN Y POLICÍA',
            'MINAE',
            'MINISTERIO DE AMBIENTE Y ENERGÍA',
            'MINISTERIO DE EDUCACIÓN PÚBLICA',
            'MINISTERIO DE HACIENDA',
            'MINISTERIO DE JUSTICIA Y GRACIA',
            'MINISTERIO DE LA PRESIDENCIA',
            'MINISTERIO DE OBRAS PUBL. Y TRANSPORTE',
            'MINISTERIO DE PLANIF.NAC Y POL.ECO',
            'MINISTERIO DE RELACIONES EXTERIORES Y CULTO',
            'MINISTERIO DE SALUD',
            'MINISTERIO DE SEGURIDAD PÚBLICA',
            'MINISTERIO DE TRAB. Y SEGUR. SOC',
            'MINISTERIO DE VIVIENDA Y ASENT.HUMANOS',
            'MUNICIPALIDAD DE ALVARADO',
            'MUNICIPALIDAD DE ASERRI',
            'MUNICIPALIDAD DE CORONADO',
            'MUNICIPALIDAD DE CORREDORES',
            'MUNICIPALIDAD DE DESAMPARADOS',
            'MUNICIPALIDAD DE GOICOECHEA',
            'MUNICIPALIDAD DE MORA',
            'MUNICIPALIDAD DE MORAVIA',
            'MUNICIPALIDAD DE NARANJO',
            'MUNICIPALIDAD DE OREAMUNO',
            'MUNICIPALIDAD DE OROTIÑA',
            'MUNICIPALIDAD DE PALMARES',
            'MUNICIPALIDAD DE PARRITA',
            'MUNICIPALIDAD DE PUNTARENAS',
            'MUNICIPALIDAD DE SAN MATEO',
            'MUNICIPALIDAD DE SAN PABLO',
            'MUNICIPALIDAD DE SAN VITO',
            'MUNICIPALIDAD DE TIBÁS',
            'MUNICIPALIDAD GRECIA',
            'MUNICIPALIDAD SAN JOSÉ',
            'MUSEO NACIONAL',
            'O.T.M.',
            'P.A.N.I',
            'PENSIONADOS PODER JUDICIAL',
            'PERSONA JOVEN',
            'PODER JUDICIAL',
            'PRESIDENCIA DE LA REPÚBLICA',
            'PROCURADURÍA GENERAL DE LA REPÚBLICA',
            'RECOPE',
            'REGISTRO NACIONAL',
            'SEC',
            'SENASA',
            'SERVICIO EXTERIOR',
            'TEATRO NACIONAL',
            'TRIBUNAL DE SERVICIO CIVIL',
            'TRIBUNAL SUPREMO DE ELECCIONES',
            'UCR',
            'UCR UNIVERSIDAD DE COSTA RICA'
        ];

        function renderCompanyOptions(filter = '') {
            const list = document.getElementById('companyList');
            list.innerHTML = '';
            const term = filter.trim().toLowerCase();
            companyOptions.forEach(name => {
                if (term && !name.toLowerCase().includes(term)) return;
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.textContent = name;
                btn.className = 'w-full text-left px-3 py-2 text-sm hover:bg-gray-100';
                btn.addEventListener('click', () => selectCompany(name));
                list.appendChild(btn);
            });
            if (!list.children.length) {
                const empty = document.createElement('div');
                empty.className = 'px-3 py-2 text-sm text-muted-foreground';
                empty.textContent = 'Sin resultados';
                list.appendChild(empty);
            }
        }

        function selectCompany(name) {
            const hidden = document.getElementById('companyValue');
            const label = document.getElementById('companyLabel');
            hidden.value = name || '';
            label.textContent = name || 'Selecciona';
            label.classList.toggle('text-muted-foreground', !name);
            closeCompanyDropdown();
        }

        function openCompanyDropdown() {
            document.getElementById('companyDropdown').classList.remove('hidden');
            renderCompanyOptions(document.getElementById('companySearch').value || '');
            document.getElementById('companySearch').focus();
        }

        function closeCompanyDropdown() {
            document.getElementById('companyDropdown').classList.add('hidden');
        }

        function toggleCompanyDropdown() {
            const dropdown = document.getElementById('companyDropdown');
            if (dropdown.classList.contains('hidden')) {
                openCompanyDropdown();
            } else {
                closeCompanyDropdown();
            }
        }

        function validateStep(index) {
            clearAlert();
            if (index === 0) {
                const interes = document.querySelector('input[name="interes"]:checked');
                if (!interes) {
                    showAlert('Selecciona qué te interesa para continuar.');
                    return false;
                }
            }
            if (index === 1) {
                const interes = document.querySelector('input[name="interes"]:checked')?.value;
                if (interes === 'credito' || interes === 'ambos') {
                    const monto = document.querySelector('select[name="monto"]').value;
                    const uso = document.querySelector('select[name="uso_credito"]').value;
                    const condicion = document.querySelector('input[name="condicion_laboral"]:checked')?.value;
                    if (!monto || !uso || !condicion) {
                        showAlert('Completa los datos de crédito y selecciona tu condición laboral.');
                        return false;
                    }
                    // Solo requerir empresa si es empleado activo
                    if (condicion === 'empleado_activo') {
                        const situacion = document.getElementById('companyValue').value;
                        if (!situacion) {
                            showAlert('Selecciona la empresa en la que laboras.');
                            return false;
                        }
                    }
                }
                if (interes === 'servicios_legales' || interes === 'ambos') {
                    const tramites = Array.from(document.querySelectorAll('input[name="tramites"]:checked'));
                    const urgencia = document.querySelector('select[name="urgencia"]').value;
                    if (tramites.length === 0 || !urgencia) {
                        showAlert('Selecciona al menos un trámite legal y la urgencia.');
                        return false;
                    }
                }
            }
            if (index === 2) {
                const experiencia = document.querySelector('select[name="experiencia_crediticia"]').value;
                const historial = document.querySelector('select[name="historial_mora"]').value;
                const vivienda = document.querySelector('select[name="tipo_vivienda"]').value;
                const dependientes = document.querySelector('select[name="dependientes"]').value;
                if (!experiencia || !historial || !vivienda || !dependientes) {
                    showAlert('Completa todos los campos obligatorios del perfil financiero.');
                    return false;
                }
            }
            return true;
        }

        function collectData() {
            const interes = document.querySelector('input[name="interes"]:checked')?.value || '';
            const data = { interes };
            if (interes === 'credito' || interes === 'ambos') {
                data.monto = document.querySelector('select[name="monto"]').value;
                data.uso_credito = document.querySelector('select[name="uso_credito"]').value;
                data.condicion_laboral = document.querySelector('input[name="condicion_laboral"]:checked')?.value || '';
                // Solo incluir situacion_laboral (empresa) si es empleado activo
                if (data.condicion_laboral === 'empleado_activo') {
                    data.situacion_laboral = document.getElementById('companyValue').value;
                }
                data.ingreso = document.querySelector('select[name="ingreso"]').value;
                data.tiene_deudas = document.querySelector('select[name="tiene_deudas"]').value;
            }
            if (interes === 'servicios_legales' || interes === 'ambos') {
                data.tramites = Array.from(document.querySelectorAll('input[name="tramites"]:checked')).map(el => el.value);
                data.urgencia = document.querySelector('select[name="urgencia"]').value;
                data.detalle_legal = document.querySelector('textarea[name="detalle_legal"]').value;
            }
            data.experiencia_crediticia = document.querySelector('select[name="experiencia_crediticia"]').value;
            data.historial_mora = document.querySelector('select[name="historial_mora"]').value;
            data.tipo_vivienda = document.querySelector('select[name="tipo_vivienda"]').value;
            data.dependientes = document.querySelector('select[name="dependientes"]').value;
            data.origen_lead = document.querySelector('select[name="origen_lead"]').value;
            return data;
        }

        function showSuccessDialog() {
            document.getElementById('successDialog').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeSuccessDialog() {
            document.getElementById('successDialog').classList.add('hidden');
            document.body.style.overflow = '';
        }

        document.addEventListener('DOMContentLoaded', () => {
            showStep(currentStep);
            renderCompanyOptions();
            document.querySelectorAll('input[name="interes"]').forEach(input => {
                input.addEventListener('change', updateDynamicBlocks);
            });
            // Ocultar empresaWrapper al inicio (hasta que se seleccione condición laboral)
            document.getElementById('empresaWrapper').classList.add('hidden');
            document.querySelectorAll('input[name="condicion_laboral"]').forEach(input => {
                input.addEventListener('change', updateCondicionLaboral);
            });
            document.getElementById('companyTrigger').addEventListener('click', (e) => {
                e.stopPropagation();
                toggleCompanyDropdown();
            });
            document.getElementById('companySearch').addEventListener('input', (e) => {
                renderCompanyOptions(e.target.value || '');
            });
            document.addEventListener('click', (e) => {
                const dropdown = document.getElementById('companyDropdown');
                const container = document.getElementById('companyContainer');
                if (!container.contains(e.target)) {
                    dropdown.classList.add('hidden');
                }
            });
            document.getElementById('backBtn').addEventListener('click', () => {
                if (currentStep > 0) {
                    currentStep -= 1;
                    showStep(currentStep);
                }
            });
            document.getElementById('nextBtn').addEventListener('click', () => {
                if (!validateStep(currentStep)) return;
                if (currentStep < steps.length - 1) {
                    currentStep += 1;
                    showStep(currentStep);
                }
            });
            document.getElementById('questionnaireForm').addEventListener('submit', (e) => {
                e.preventDefault();
                if (!validateStep(2)) return;
                const data = collectData();
                console.log('Respuestas cuestionario público', data);
                showAlert('Respuestas guardadas. Pronto te contactaremos.', 'success');
                showSuccessDialog();
            });
        });
    </script>
</body>
</html>
